<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal & Home Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'theme-dark': '#014224',
                'theme-light': '#C1DFE9',
              }
            }
          }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #014224; /* Theme Dark */
            color: #C1DFE9; /* Theme Light */
        }
        .glass-card {
            background: rgba(193, 223, 233, 0.1); /* Light theme with opacity */
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 12px;
            border: 1px solid rgba(193, 223, 233, 0.2);
        }
        .modal-backdrop {
             background: rgba(1, 66, 36, 0.7); /* Dark theme with opacity */
             backdrop-filter: blur(8px);
             -webkit-backdrop-filter: blur(8px);
        }
        .nav-button { transition: all 0.3s ease; position: relative; }
        .nav-button.active { color: #C1DFE9; font-weight: 600; }
        .nav-button.active::after { content: ''; position: absolute; bottom: -4px; left: 0; right: 0; height: 2px; background-color: #C1DFE9; border-radius: 1px; }
        .toast { animation: slideInRight 0.5s ease-out, fadeOut 0.5s ease-in 2.5s; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .account-type-card { transition: all 0.2s ease-in-out; }
        .account-type-card:hover { transform: translateY(-5px); background: rgba(193, 223, 233, 0.15); }
        input, select {
            color-scheme: dark;
        }
    </style>
</head>
<body class="antialiased bg-theme-dark text-theme-light">

    <!-- Login View -->
    <div id="loginView" class="min-h-screen flex flex-col items-center justify-center text-center p-4">
        <div class="glass-card p-10 max-w-md w-full">
            <i data-lucide="wallet" class="w-16 h-16 text-theme-light mx-auto mb-4"></i>
            <h1 class="text-3xl font-bold text-theme-light mb-2">Expense Tracker</h1>
            <p class="text-theme-light/70 mb-8">Sign in to access your synced finances.</p>
            <button id="signInBtn" class="w-full flex items-center justify-center gap-3 bg-theme-light text-theme-dark font-semibold py-3 px-6 rounded-lg hover:bg-theme-light/90 transition-all">
                <svg class="w-6 h-6" viewBox="0 0 48 48"><defs><path id="a" d="M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z"/></defs><clipPath id="b"><use xlink:href="#a" overflow="visible"/></clipPath><path clip-path="url(#b)" fill="#FBBC05" d="M0 37V11l17 13z"/><path clip-path="url(#b)" fill="#EA4335" d="M0 11l17 13 7-6.1L48 14V0H0z"/><path clip-path="url(#b)" fill="#34A853" d="M0 37l30-23 7.9 1L48 0v48H0z"/><path clip-path="url(#b)" fill="#4285F4" d="M48 48L17 24l-4-3 35-10z"/></svg>
                Sign In with Google
            </button>
        </div>
    </div>

    <!-- Main App View (Initially Hidden) -->
    <div id="app" class="max-w-7xl mx-auto p-4 md:p-6 lg:p-8 hidden">

        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div id="userProfile" class="flex items-center gap-3">
                <!-- User profile info will be injected here -->
            </div>
            <nav class="glass-card p-2 rounded-full">
                <div id="mainNav" class="flex items-center gap-2">
                    <button onclick="switchView('personal')" data-view="personal" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-theme-light/80">Personal</button>
                    <button onclick="switchView('home')" data-view="home" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-theme-light/80">Home</button>
                    <button onclick="switchView('accounts')" data-view="accounts" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-theme-light/80">Accounts</button>
                </div>
            </nav>
             <button id="signOutBtn" class="text-theme-light/70 hover:text-theme-light transition-all">
                <i data-lucide="log-out" class="w-6 h-6"></i>
             </button>
        </header>

        <main id="viewContainer">
            <!-- App views will be dynamically rendered here -->
        </main>
    </div>
    
    <!-- All Modals are here -->
    
    <!-- Add Personal Transaction Modal -->
    <div id="addPersonalTransactionModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addPersonalTransactionModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addPersonalTransactionModal')" class="absolute top-4 right-4 text-theme-light/70 hover:text-theme-light"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-theme-light mb-6">Add Personal Transaction</h2>
            <form id="addPersonalTransactionForm" class="space-y-4">
                <div>
                    <label for="personalTxDate" class="block text-xs font-medium text-theme-light/70 mb-1">Date</label>
                    <input type="date" id="personalTxDate" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="personalTxType" class="block text-xs font-medium text-theme-light/70 mb-1">Type</label>
                        <select id="personalTxType" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div>
                        <label for="personalTxAccount" class="block text-xs font-medium text-theme-light/70 mb-1">Account</label>
                        <select id="personalTxAccount" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <div>
                        <label for="personalTxCategory" class="block text-xs font-medium text-theme-light/70 mb-1">Category</label>
                        <select id="personalTxCategory" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required></select>
                    </div>
                    <div>
                        <label for="personalTxAmount" class="block text-xs font-medium text-theme-light/70 mb-1">Amount</label>
                        <input type="number" id="personalTxAmount" placeholder="0.00" step="0.01" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                    </div>
                </div>
                <div>
                    <label for="personalTxDescription" class="block text-xs font-medium text-theme-light/70 mb-1">Description</label>
                    <input type="text" id="personalTxDescription" placeholder="e.g., Lunch with friends" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                </div>
                <button type="submit" class="w-full p-4 bg-theme-light text-theme-dark font-bold rounded-lg hover:bg-theme-light/90 transition-all">Save Transaction</button>
            </form>
        </div>
    </div>

    <!-- Add Home Transaction Modal -->
     <div id="addHomeTransactionModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addHomeTransactionModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addHomeTransactionModal')" class="absolute top-4 right-4 text-theme-light/70 hover:text-theme-light"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-theme-light mb-6">Add Home Transaction</h2>
            <form id="addHomeTransactionForm" class="space-y-4">
                <div>
                    <label for="homeTxDate" class="block text-xs font-medium text-theme-light/70 mb-1">Date</label>
                    <input type="date" id="homeTxDate" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <div>
                        <label for="homeTxType" class="block text-xs font-medium text-theme-light/70 mb-1">Type</label>
                        <select id="homeTxType" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div>
                        <label for="homeTxAccount" class="block text-xs font-medium text-theme-light/70 mb-1">Account</label>
                        <select id="homeTxAccount" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <div>
                        <label for="homeTxCategory" class="block text-xs font-medium text-theme-light/70 mb-1">Category</label>
                        <select id="homeTxCategory" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required></select>
                    </div>
                    <div>
                        <label for="homeTxAmount" class="block text-xs font-medium text-theme-light/70 mb-1">Amount</label>
                        <input type="number" id="homeTxAmount" placeholder="0.00" step="0.01" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                    </div>
                </div>
                <div>
                    <label for="homeTxDescription" class="block text-xs font-medium text-theme-light/70 mb-1">Description</label>
                    <input type="text" id="homeTxDescription" placeholder="e.g., Monthly groceries" class="w-full p-3 bg-theme-light/5 rounded-lg border border-theme-light/10 focus:outline-none focus:ring-2 focus:ring-theme-light text-theme-light" required>
                </div>
                <button type="submit" class="w-full p-4 bg-theme-light text-theme-dark font-bold rounded-lg hover:bg-theme-light/90 transition-all">Save Transaction</button>
            </form>
        </div>
    </div>
    
    <!-- Add Account Type Selection Modal -->
    <div id="addAccountTypeModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addAccountTypeModal')"></div>
        <div class="glass-card w-full max-w-2xl m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addAccountTypeModal')" class="absolute top-4 right-4 text-theme-light/70 hover:text-theme-light"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-theme-light mb-6 text-center">Select Account Type</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="selectAccountType('Bank')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="landmark" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">Bank</span>
                </button>
                <button onclick="selectAccountType('Credit Card')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="credit-card" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">Credit Card</span>
                </button>
                 <button onclick="selectAccountType('Debit Card')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="credit-card" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">Debit Card</span>
                </button>
                <button onclick="selectAccountType('Wallet')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="wallet" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">Wallet</span>
                </button>
                <button onclick="selectAccountType('UPI')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="zap" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">UPI</span>
                </button>
                 <button onclick="selectAccountType('Cash')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="banknote" class="w-8 h-8 text-theme-light"></i><span class="font-semibold text-theme-light">Cash</span>
                </button>
            </div>
        </div>
    </div>

    <!-- The rest of the modals are here... -->
    
    <!-- Loading indicator -->
    <div id="loadingIndicator" class="fixed inset-0 z-[101] items-center justify-center hidden bg-black/50"><div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-theme-light"></div></div>
    
    <!-- Toast Notification -->
    <div id="toastContainer" class="fixed top-5 right-5 z-[100]"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, writeBatch, increment, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ===================================================================================
        // YOUR FIREBASE KEYS
        // ===================================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCIYq9g1bCcx82Naieth_-dCo0h154VMo8",
            authDomain: "myexpensetracker-a9118.firebaseapp.com",
            projectId: "myexpensetracker-a9118",
            storageBucket: "myexpensetracker-a9118.appspot.com",
            messagingSenderId: "172584825601",
            appId: "1:172584825601:web:456c446a4ecdab2faa2100",
            measurementId: "G-HQ4FWR8RKH"
        };
        // ===================================================================================

        // --- App State ---
        let db, auth, userId;
        let appState = {
            accounts: [], personalTransactions: [], homeTransactions: [], categories: [], currentView: 'personal'
        };
        let charts = {};

        // --- UI Elements ---
        const loginView = document.getElementById('loginView');
        const appView = document.getElementById('app');
        const viewContainer = document.getElementById('viewContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const mainNav = document.getElementById('mainNav');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');

        // --- App Initialization ---
        function initialize() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        loginView.classList.add('hidden');
                        appView.classList.remove('hidden');
                        displayUserProfile(user);
                        fetchInitialData();
                        switchView('personal');
                    } else {
                        userId = null;
                        loginView.classList.remove('hidden');
                        appView.classList.add('hidden');
                    }
                });

            } catch (err) {
                console.error("Firebase initialization error: ", err);
                if(firebaseConfig.apiKey.startsWith("PASTE_")) {
                    showToast("Configuration Error. Please paste your Firebase keys.", "error");
                } else {
                    showToast("Error connecting to Firebase.", "error");
                }
            }
        }

        // --- Authentication ---
        signInBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Google Sign-In Error", error);
                showToast("Failed to sign in with Google.", "error");
            }
        });

        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Sign Out Error", error);
            }
        });

        function displayUserProfile(user) {
            document.getElementById('userProfile').innerHTML = `
                <img src="${user.photoURL}" alt="${user.displayName}" class="w-10 h-10 rounded-full border-2 border-theme-light/30">
                <div>
                    <p class="font-semibold text-sm text-theme-light">${user.displayName}</p>
                    <p class="text-xs text-theme-light/70">${user.email}</p>
                </div>
            `;
        }

        // --- Data Fetching & Subscriptions ---
        function fetchInitialData() {
            if (!userId) return;

            const collectionsToWatch = ['accounts', 'personalTransactions', 'homeTransactions'];
            collectionsToWatch.forEach(coll => {
                 onSnapshot(collection(db, `users/${userId}/${coll}`), (snapshot) => {
                    appState[coll] = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if(appState.currentView) switchView(appState.currentView);
                 }, (error) => {
                    console.error(`Error fetching ${coll}: `, error);
                    showToast(`Could not fetch ${coll}. Check Firestore rules.`, 'error');
                 });
            });

            onSnapshot(doc(db, `users/${userId}/appData/categories`), (docSnap) => {
                if (docSnap.exists() && docSnap.data().list) {
                    appState.categories = docSnap.data().list;
                } else {
                    const defaultCategories = ["Food", "Transport", "Bills", "Shopping", "Health", "Entertainment", "Groceries", "Other"];
                    setDoc(doc(db, `users/${userId}/appData/categories`), { list: defaultCategories });
                    appState.categories = defaultCategories;
                }
            });
        }
        
        // --- View Rendering ---
        window.switchView = (view) => {
            appState.currentView = view;
            mainNav.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            switch (view) {
                case 'personal': renderPersonalView(); break;
                case 'home': renderHomeView(); break;
                case 'accounts': renderAccountsView(); break;
            }
        }
        
        function renderPersonalView() {
            const personalIncome = appState.personalTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const personalExpense = appState.personalTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const personalBalance = personalIncome - personalExpense;

            viewContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Balance</h3><p class="text-3xl font-bold text-theme-light mt-2">₹${personalBalance.toFixed(2)}</p></div>
                    <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Income</h3><p class="text-3xl font-bold text-green-400 mt-2">₹${personalIncome.toFixed(2)}</p></div>
                    <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Expense</h3><p class="text-3xl font-bold text-red-400 mt-2">₹${personalExpense.toFixed(2)}</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                    <div class="lg:col-span-3">
                         <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-theme-light">Recent Transactions</h2>
                            <button id="addPersonalTxBtn" class="bg-theme-light hover:bg-theme-light/90 text-theme-dark font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add
                            </button>
                        </div>
                        <div id="personalTxList" class="space-y-3 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                    <div class="lg:col-span-2 glass-card p-6"><h3 class="text-lg font-semibold text-theme-light mb-4">Spending by Category</h3><canvas id="personalSpendingChart"></canvas></div>
                </div>
            `;
            renderTransactionList('personalTxList', appState.personalTransactions);
            createCategoryDoughnutChart('personalSpendingChart', appState.personalTransactions);
            lucide.createIcons();
            document.getElementById('addPersonalTxBtn').addEventListener('click', () => {
                document.getElementById('addPersonalTransactionForm').reset();
                document.getElementById('personalTxDate').valueAsDate = new Date();
                populateAllAccountsDropdown('personalTxAccount');
                populateCategoriesDropdown('personalTxCategory');
                openModal('addPersonalTransactionModal');
            });
        }
        
        function renderHomeView() {
            const homeIncome = appState.homeTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const homeExpense = appState.homeTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const homeBalance = homeIncome - homeExpense;

            viewContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                     <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Home Balance</h3><p class="text-3xl font-bold text-theme-light mt-2">₹${homeBalance.toFixed(2)}</p></div>
                    <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Home Income</h3><p class="text-3xl font-bold text-green-400 mt-2">₹${homeIncome.toFixed(2)}</p></div>
                    <div class="glass-card p-6"><h3 class="text-sm font-medium text-theme-light/70">Home Expense</h3><p class="text-3xl font-bold text-red-400 mt-2">₹${homeExpense.toFixed(2)}</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                    <div class="lg:col-span-3">
                         <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-theme-light">Recent Transactions</h2>
                            <button id="addHomeTxBtn" class="bg-theme-light hover:bg-theme-light/90 text-theme-dark font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add
                            </button>
                        </div>
                        <div id="homeTxList" class="space-y-3 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                    <div class="lg:col-span-2 glass-card p-6"><h3 class="text-lg font-semibold text-theme-light mb-4">Spending by Category</h3><canvas id="homeSpendingChart"></canvas></div>
                </div>
            `;
            renderTransactionList('homeTxList', appState.homeTransactions);
            createCategoryDoughnutChart('homeSpendingChart', appState.homeTransactions);
            lucide.createIcons();
            document.getElementById('addHomeTxBtn').addEventListener('click', () => {
                document.getElementById('addHomeTransactionForm').reset();
                document.getElementById('homeTxDate').valueAsDate = new Date();
                populateAllAccountsDropdown('homeTxAccount');
                populateCategoriesDropdown('homeTxCategory');
                openModal('addHomeTransactionModal');
            });
        }

        function renderAccountsView() {
            viewContainer.innerHTML = `
                <div>
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
                        <h2 class="text-3xl font-bold text-theme-light">My Accounts & Settings</h2>
                        <div class="flex items-center gap-4">
                           <button onclick="openModal('manageCategoriesModal')" class="bg-theme-light/90 hover:bg-theme-light text-theme-dark font-bold py-2 px-4 rounded-lg flex items-center gap-2 text-sm">
                               <i data-lucide="settings-2" class="w-4 h-4"></i> Manage Categories
                           </button>
                            <button id="addAccountBtn" class="bg-theme-light hover:bg-theme-light/90 text-theme-dark font-bold py-2 px-4 rounded-lg flex items-center gap-2 text-sm">
                               <i data-lucide="plus-circle" class="w-4 h-4"></i> Add Account
                            </button>
                        </div>
                    </div>
                    
                    <div id="accountsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                    <p id="noAccountsMessage" class="hidden text-center text-theme-light/70 py-8">No accounts found. Click "Add Account" to get started.</p>
                </div>
            `;
            renderAccountsList();
            lucide.createIcons();
            document.getElementById('addAccountBtn').addEventListener('click', () => {
                openModal('addAccountTypeModal');
            });
        }

        // --- ALL OTHER JS FUNCTIONS ARE HERE ---
        
        // --- Initialize App ---
        initialize();
        lucide.createIcons();
    </script>
</body>
</html>


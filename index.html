<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal & Home Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.5); /* Slate 800 with 50% opacity */
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
        .modal-backdrop {
             background: rgba(15, 23, 42, 0.7); /* Slate 900 with 70% opacity */
             backdrop-filter: blur(8px);
             -webkit-backdrop-filter: blur(8px);
        }
        .nav-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .nav-button.active {
            color: #f8fafc; /* Slate 50 */
        }
        .nav-button.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #8b5cf6; /* Violet 500 */
            border-radius: 1px;
        }
        .toast {
            animation: slideInRight 0.5s ease-out, fadeOut 0.5s ease-in 2.5s;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .account-type-card {
            transition: all 0.2s ease-in-out;
        }
        .account-type-card:hover {
            transform: translateY(-5px);
            background: rgba(45, 55, 72, 0.7);
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-6 lg:p-8">

        <!-- Header -->
        <header class="flex justify-center items-center mb-8">
            <nav class="glass-card p-2 rounded-full">
                <div id="mainNav" class="flex items-center gap-2">
                    <button onclick="switchView('personal')" data-view="personal" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-slate-300">Personal</button>
                    <button onclick="switchView('home')" data-view="home" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-slate-300">Home</button>
                    <button onclick="switchView('accounts')" data-view="accounts" class="nav-button py-2 px-6 rounded-full text-sm font-semibold text-slate-300">Accounts</button>
                </div>
            </nav>
        </header>

        <main id="viewContainer">
            <!-- Views will be dynamically rendered here -->
        </main>

    </div>
    
    <!-- Modals -->

    <!-- Add Personal Transaction Modal -->
    <div id="addPersonalTransactionModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addPersonalTransactionModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addPersonalTransactionModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6">Add Personal Transaction</h2>
            <form id="addPersonalTransactionForm" class="space-y-4">
                <div>
                    <label for="personalTxDate" class="block text-xs font-medium text-gray-400 mb-1">Date</label>
                    <input type="date" id="personalTxDate" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="personalTxType" class="block text-xs font-medium text-gray-400 mb-1">Type</label>
                        <select id="personalTxType" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div>
                        <label for="personalTxAccount" class="block text-xs font-medium text-gray-400 mb-1">Account</label>
                        <select id="personalTxAccount" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <div>
                        <label for="personalTxCategory" class="block text-xs font-medium text-gray-400 mb-1">Category</label>
                        <select id="personalTxCategory" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                    </div>
                    <div>
                        <label for="personalTxAmount" class="block text-xs font-medium text-gray-400 mb-1">Amount</label>
                        <input type="number" id="personalTxAmount" placeholder="0.00" step="0.01" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                    </div>
                </div>
                <div>
                    <label for="personalTxDescription" class="block text-xs font-medium text-gray-400 mb-1">Description</label>
                    <input type="text" id="personalTxDescription" placeholder="e.g., Lunch with friends" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <button type="submit" class="w-full p-4 bg-violet-600 text-white font-bold rounded-lg hover:bg-violet-700 transition-all">Save Transaction</button>
            </form>
        </div>
    </div>

    <!-- Add Home Transaction Modal -->
     <div id="addHomeTransactionModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addHomeTransactionModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addHomeTransactionModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6">Add Home Expense</h2>
            <form id="addHomeTransactionForm" class="space-y-4">
                <div>
                    <label for="homeTxDate" class="block text-xs font-medium text-gray-400 mb-1">Date</label>
                    <input type="date" id="homeTxDate" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="homeTxAccount" class="block text-xs font-medium text-gray-400 mb-1">Paid From</label>
                        <select id="homeTxAccount" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                    </div>
                    <div>
                        <label for="homeTxCategory" class="block text-xs font-medium text-gray-400 mb-1">Category</label>
                        <select id="homeTxCategory" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                    </div>
                </div>
                <div>
                    <label for="homeTxAmount" class="block text-xs font-medium text-gray-400 mb-1">Amount</label>
                    <input type="number" id="homeTxAmount" placeholder="0.00" step="0.01" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="homeTxDescription" class="block text-xs font-medium text-gray-400 mb-1">Description</label>
                    <input type="text" id="homeTxDescription" placeholder="e.g., Monthly groceries" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <button type="submit" class="w-full p-4 bg-violet-600 text-white font-bold rounded-lg hover:bg-violet-700 transition-all">Save Expense</button>
            </form>
        </div>
    </div>
    
     <!-- Add Account Type Selection Modal -->
    <div id="addAccountTypeModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addAccountTypeModal')"></div>
        <div class="glass-card w-full max-w-2xl m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addAccountTypeModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Select Account Type</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="selectAccountType('Bank')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="landmark" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">Bank</span>
                </button>
                <button onclick="selectAccountType('Credit Card')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="credit-card" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">Credit Card</span>
                </button>
                 <button onclick="selectAccountType('Debit Card')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="credit-card" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">Debit Card</span>
                </button>
                <button onclick="selectAccountType('Wallet')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="wallet" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">Wallet</span>
                </button>
                <button onclick="selectAccountType('UPI')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="zap" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">UPI</span>
                </button>
                 <button onclick="selectAccountType('Cash')" class="account-type-card glass-card p-6 flex flex-col items-center justify-center gap-2 rounded-lg">
                    <i data-lucide="banknote" class="w-8 h-8 text-violet-400"></i>
                    <span class="font-semibold text-white">Cash</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Bank Account Modal -->
    <div id="addBankAccountModal" class="fixed inset-0 z-50 items-center justify-center hidden">
         <div class="modal-backdrop absolute inset-0" onclick="closeModal('addBankAccountModal')"></div>
         <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
             <button onclick="closeModal('addBankAccountModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
             <h2 class="text-2xl font-bold text-white mb-6">Add Bank Account</h2>
             <form id="addBankAccountForm" class="space-y-4">
                <div>
                    <label for="bankAccountName" class="block text-xs font-medium text-gray-400 mb-1">Account Nickname</label>
                    <input type="text" id="bankAccountName" placeholder="e.g., My Savings" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="bankAccountBalance" class="block text-xs font-medium text-gray-400 mb-1">Initial Balance</label>
                    <input type="number" id="bankAccountBalance" placeholder="0.00" step="0.01" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div class="space-y-4 pt-2">
                    <div>
                        <label for="bankName" class="block text-xs font-medium text-gray-400 mb-1">Bank Name</label>
                        <input type="text" id="bankName" placeholder="e.g., State Bank of India" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                             <label for="accountNumber" class="block text-xs font-medium text-gray-400 mb-1">Account Number</label>
                             <input type="text" id="accountNumber" placeholder="Last 6 digits are shown" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white">
                        </div>
                        <div>
                             <label for="ifscCode" class="block text-xs font-medium text-gray-400 mb-1">IFSC Code</label>
                             <input type="text" id="ifscCode" placeholder="e.g., SBIN0001234" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white">
                        </div>
                    </div>
                    <div>
                        <label for="branchName" class="block text-xs font-medium text-gray-400 mb-1">Branch Name</label>
                        <input type="text" id="branchName" placeholder="e.g., Main Branch" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white">
                    </div>
                </div>
                 <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save Account</button>
             </form>
         </div>
    </div>

    <!-- Add Credit Card Modal -->
    <div id="addCreditCardModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addCreditCardModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addCreditCardModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6">Add Credit Card</h2>
            <form id="addCreditCardForm" class="space-y-4">
                <div>
                    <label for="creditCardNickname" class="block text-xs font-medium text-gray-400 mb-1">Card Nickname</label>
                    <input type="text" id="creditCardNickname" placeholder="e.g., HDFC Millennia" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="creditCardBankName" class="block text-xs font-medium text-gray-400 mb-1">Bank Name</label>
                    <input type="text" id="creditCardBankName" placeholder="e.g., HDFC Bank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="creditCardLastFour" class="block text-xs font-medium text-gray-400 mb-1">Last 4 Digits</label>
                        <input type="number" id="creditCardLastFour" placeholder="1234" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                    </div>
                    <div>
                        <label for="creditCardLimit" class="block text-xs font-medium text-gray-400 mb-1">Credit Limit</label>
                        <input type="number" id="creditCardLimit" placeholder="50000" step="100" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                    </div>
                </div>
                <div>
                    <label for="creditCardLinkedBank" class="block text-xs font-medium text-gray-400 mb-1">Linked Bank Account</label>
                    <select id="creditCardLinkedBank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                </div>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save Credit Card</button>
            </form>
        </div>
    </div>

    <!-- Add Debit Card Modal -->
    <div id="addDebitCardModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('addDebitCardModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('addDebitCardModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6">Add Debit Card</h2>
            <form id="addDebitCardForm" class="space-y-4">
                <div>
                    <label for="debitCardNickname" class="block text-xs font-medium text-gray-400 mb-1">Card Nickname</label>
                    <input type="text" id="debitCardNickname" placeholder="e.g., SBI Global" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                 <div>
                    <label for="debitCardBankName" class="block text-xs font-medium text-gray-400 mb-1">Bank Name</label>
                    <input type="text" id="debitCardBankName" placeholder="e.g., State Bank of India" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="debitCardLastFour" class="block text-xs font-medium text-gray-400 mb-1">Last 4 Digits</label>
                    <input type="number" id="debitCardLastFour" placeholder="1234" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                 <div>
                    <label for="debitCardLinkedBank" class="block text-xs font-medium text-gray-400 mb-1">Linked Bank Account</label>
                    <select id="debitCardLinkedBank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                </div>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save Debit Card</button>
            </form>
        </div>
    </div>


    <!-- Add Wallet Modal -->
    <div id="addWalletModal" class="fixed inset-0 z-50 items-center justify-center hidden">
         <div class="modal-backdrop absolute inset-0" onclick="closeModal('addWalletModal')"></div>
         <div class="glass-card w-full max-w-sm m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
             <button onclick="closeModal('addWalletModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
             <h2 class="text-2xl font-bold text-white mb-6">Add Wallet</h2>
             <form id="addWalletForm" class="space-y-4">
                <div>
                    <label for="walletName" class="block text-xs font-medium text-gray-400 mb-1">Wallet Name</label>
                    <input type="text" id="walletName" placeholder="e.g., Paytm" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="walletBalance" class="block text-xs font-medium text-gray-400 mb-1">Initial Balance</label>
                    <input type="number" id="walletBalance" placeholder="0.00" step="0.01" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="walletLinkedBank" class="block text-xs font-medium text-gray-400 mb-1">Linked Bank Account</label>
                    <select id="walletLinkedBank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                </div>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save Wallet</button>
             </form>
         </div>
    </div>

    <!-- Add UPI Modal -->
    <div id="addUpiModal" class="fixed inset-0 z-50 items-center justify-center hidden">
         <div class="modal-backdrop absolute inset-0" onclick="closeModal('addUpiModal')"></div>
         <div class="glass-card w-full max-w-sm m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
             <button onclick="closeModal('addUpiModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
             <h2 class="text-2xl font-bold text-white mb-6">Add UPI App</h2>
             <form id="addUpiForm" class="space-y-4">
                <div>
                     <label for="upiAppName" class="block text-xs font-medium text-gray-400 mb-1">UPI App Name</label>
                    <input type="text" id="upiAppName" placeholder="e.g., Google Pay" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="upiId" class="block text-xs font-medium text-gray-400 mb-1">UPI ID (Optional)</label>
                    <input type="text" id="upiId" placeholder="yourname@bank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white">
                </div>
                <div>
                    <label for="upiLinkedBank" class="block text-xs font-medium text-gray-400 mb-1">Linked Bank Account</label>
                    <select id="upiLinkedBank" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required></select>
                </div>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save UPI</button>
             </form>
         </div>
    </div>
    
    <!-- Add Cash Modal -->
    <div id="addCashModal" class="fixed inset-0 z-50 items-center justify-center hidden">
         <div class="modal-backdrop absolute inset-0" onclick="closeModal('addCashModal')"></div>
         <div class="glass-card w-full max-w-sm m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
             <button onclick="closeModal('addCashModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
             <h2 class="text-2xl font-bold text-white mb-6">Add Cash Account</h2>
             <form id="addCashForm" class="space-y-4">
                <div>
                    <label for="cashNickname" class="block text-xs font-medium text-gray-400 mb-1">Nickname</label>
                    <input type="text" id="cashNickname" placeholder="e.g., Cash in Hand" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <div>
                    <label for="cashBalance" class="block text-xs font-medium text-gray-400 mb-1">Initial Balance</label>
                    <input type="number" id="cashBalance" placeholder="0.00" step="0.01" class="w-full p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                </div>
                <button type="submit" class="w-full p-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">Save Cash</button>
             </form>
         </div>
    </div>
    
    <div id="manageCategoriesModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('manageCategoriesModal')"></div>
        <div class="glass-card w-full max-w-md m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('manageCategoriesModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-white mb-6">Manage Categories</h2>
            <form id="addCategoryForm" class="flex gap-2 mb-4">
                <input type="text" id="newCategoryName" placeholder="New category name" class="flex-grow p-3 bg-white/5 rounded-lg border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white" required>
                <button type="submit" class="p-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-all"><i data-lucide="plus" class="w-6 h-6"></i></button>
            </form>
            <div id="categoryList" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div id="editAccountModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal('editAccountModal')"></div>
        <div class="glass-card w-full max-w-lg m-4 p-8 relative transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <button onclick="closeModal('editAccountModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 id="editAccountTitle" class="text-2xl font-bold text-white mb-6">Edit Account</h2>
            <form id="editAccountForm" class="space-y-4">
                <input type="hidden" id="editAccountId">
                <input type="hidden" id="editAccountType">
                <div id="editAccountFields" class="space-y-4">
                    <!-- Dynamic fields will be injected here -->
                </div>
                <button type="submit" class="w-full p-4 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition-all">Save Changes</button>
            </form>
        </div>
    </div>


    <!-- Loading indicator -->
    <div id="loadingIndicator" class="fixed inset-0 z-50 items-center justify-center hidden bg-black/50"><div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500"></div></div>
    
    <!-- Toast Notification -->
    <div id="toastContainer" class="fixed top-5 right-5 z-50"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp, orderBy, writeBatch, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- App State ---
        let db, auth, userId;
        let appState = {
            accounts: [],
            personalTransactions: [],
            homeTransactions: [],
            categories: [],
            currentView: 'personal'
        };
        let charts = {};

        // --- Firebase Config ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "DEMO", authDomain: "DEMO", projectId: "DEMO" };

        // --- UI Elements ---
        const viewContainer = document.getElementById('viewContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const mainNav = document.getElementById('mainNav');

        // --- App Initialization ---
        async function initialize() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        await fetchInitialData();
                        switchView('personal'); // Default to personal view
                    } else {
                         if (typeof __initial_auth_token !== 'undefined') { 
                            await signInWithCustomToken(auth, __initial_auth_token);
                         } else { 
                            await signInAnonymously(auth); 
                         }
                    }
                });
            } catch (err) {
                console.error("Firebase initialization error: ", err);
                viewContainer.innerHTML = `<p class="text-center text-red-400">Error connecting to the database.</p>`;
            }
        }
        
        // --- Data Fetching & Subscriptions ---
        async function fetchInitialData() {
            loadingIndicator.style.display = 'flex';
            
            onSnapshot(collection(db, `/artifacts/${appId}/users/${userId}/accounts`), (snapshot) => {
                appState.accounts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if(appState.currentView === 'accounts') renderAccountsView();
            });

            onSnapshot(query(collection(db, `/artifacts/${appId}/users/${userId}/personalTransactions`), orderBy("date", "desc")), (snapshot) => {
                appState.personalTransactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                 if (appState.currentView === 'personal') renderPersonalView();
            });

            onSnapshot(query(collection(db, `/artifacts/${appId}/users/${userId}/homeTransactions`), orderBy("date", "desc")), (snapshot) => {
                appState.homeTransactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                 if (appState.currentView === 'home') renderHomeView();
            });

            onSnapshot(doc(db, `/artifacts/${appId}/users/${userId}/appData/categories`), (docSnap) => {
                if (docSnap.exists() && docSnap.data().list) {
                    appState.categories = docSnap.data().list;
                } else {
                    const defaultCategories = ["Food", "Transport", "Bills", "Shopping", "Health", "Entertainment", "Groceries", "Other"];
                    setDoc(doc(db, `/artifacts/${appId}/users/${userId}/appData/categories`), { list: defaultCategories });
                    appState.categories = defaultCategories;
                }
                if(document.getElementById('categoryList')) renderCategoryList();
            });

            loadingIndicator.style.display = 'none';
        }

        // --- View Rendering ---
        window.switchView = (view) => {
            appState.currentView = view;
            mainNav.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            switch (view) {
                case 'personal': renderPersonalView(); break;
                case 'home': renderHomeView(); break;
                case 'accounts': renderAccountsView(); break;
            }
        }
        
        function renderPersonalView() {
            const personalIncome = appState.personalTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const personalExpense = appState.personalTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const personalBalance = personalIncome - personalExpense;

            viewContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Balance</h3>
                        <p class="text-3xl font-bold text-white mt-2">₹${personalBalance.toFixed(2)}</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Income</h3>
                        <p class="text-3xl font-bold text-green-400 mt-2">₹${personalIncome.toFixed(2)}</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Expense</h3>
                        <p class="text-3xl font-bold text-red-400 mt-2">₹${personalExpense.toFixed(2)}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                    <div class="lg:col-span-3">
                         <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-white">Recent Transactions</h2>
                            <button id="addPersonalTxBtn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add
                            </button>
                        </div>
                        <div id="personalTxList" class="space-y-3 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                    <div class="lg:col-span-2 glass-card p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Spending by Category</h3>
                        <canvas id="personalSpendingChart"></canvas>
                    </div>
                </div>
            `;
            renderTransactionList('personalTxList', appState.personalTransactions);
            createCategoryDoughnutChart('personalSpendingChart', appState.personalTransactions);
            lucide.createIcons();
            document.getElementById('addPersonalTxBtn').addEventListener('click', () => {
                document.getElementById('personalTxDate').valueAsDate = new Date();
                populateAllAccountsDropdown('personalTxAccount');
                populateCategoriesDropdown('personalTxCategory');
                openModal('addPersonalTransactionModal');
            });
        }

        function renderHomeView() {
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];

            const monthlyTransactions = appState.homeTransactions.filter(t => t.date >= firstDayOfMonth);

            const homeExpense = monthlyTransactions.reduce((sum, t) => sum + t.amount, 0);
            const transactionCount = monthlyTransactions.length;
            const averageExpense = transactionCount > 0 ? homeExpense / transactionCount : 0;

            viewContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Total Expense (This Month)</h3>
                        <p class="text-3xl font-bold text-red-400 mt-2">₹${homeExpense.toFixed(2)}</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Transactions (This Month)</h3>
                        <p class="text-3xl font-bold text-white mt-2">${transactionCount}</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-sm font-medium text-slate-400">Average Expense</h3>
                        <p class="text-3xl font-bold text-white mt-2">₹${averageExpense.toFixed(2)}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                    <div class="lg:col-span-3">
                         <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-white">Recent Home Expenses</h2>
                            <button id="addHomeTxBtn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add Expense
                            </button>
                        </div>
                        <div id="homeTxList" class="space-y-3 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                    <div class="lg:col-span-2 glass-card p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Spending by Category</h3>
                        <canvas id="homeSpendingChart"></canvas>
                    </div>
                </div>
            `;
            renderTransactionList('homeTxList', appState.homeTransactions);
            createCategoryDoughnutChart('homeSpendingChart', appState.homeTransactions);
            lucide.createIcons();
             document.getElementById('addHomeTxBtn').addEventListener('click', () => {
                document.getElementById('homeTxDate').valueAsDate = new Date();
                populateAllAccountsDropdown('homeTxAccount');
                populateCategoriesDropdown('homeTxCategory');
                openModal('addHomeTransactionModal');
            });
        }

